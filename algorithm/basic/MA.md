# 矩阵乘法

## 预备知识

### 矩阵

矩阵可以看成一个$$n\times m$$的数表，其中n,m均为正整数

如：

$$\begin{bmatrix} 0 & -1 \\ 1 & 0 \end{bmatrix}\quad$$  
一般可以用M\[i,j\] 表示第i行，第j个数

### 矩阵乘法

定义矩阵A,B。A和B可以作乘法操作当且仅当A的大小是a×b，B的大小是 b×c，其中a,b,c皆为正整数。设矩阵C = AB，则C的大小是a×c，且有

$$C[i,j] = \sum\limits_{i=1}^k A[i,k]B[k,j] (1 \leqslant i \leqslant a,1\leqslant j \leqslant c) $$ \(1\)

从上面的运算中我们也可以看出矩阵乘法满足结合律，即\(AB\)C = A\(BC\)。

直接按照定义进行矩阵乘法时间复杂度是O\(abc\)，其中a,b,c分别表示两 个矩阵大小是a×b以及b×c。  
将两个N ×N的矩阵相乘，朴素算法的时间复 杂度为O\(N3\)。其他有一些算法有更低的复杂度，例如 Strassen 算法时间 复杂度约为$$O(N^{2.81})$$。而现有的算法中理论复杂度最低的是 Coppersmith— Winograd 算法，时间复杂度约为$$O(N^{2.36})$$。

### 矩阵快速幂

根据矩阵的结合律，可以带入普通的快速幂算法。

## 应用

### 路径计数

我们知道图可以表示成一个邻接矩阵。那么图邻接矩阵上的乘法能得到什么呢？

首先，我们来看一下最简单的情况，一张N个点的无向无权图。如果点a和 点b连边，那么邻接矩阵$$G[a,b] = G[b,a] = 1$$，否则都等于0。考虑邻接矩阵自乘，即$$G^2:$$

$$G^2 [a,b] = \sum\limits_{i=1}^N G[a,i]G[i,b] $$

上式中，$$G[a,i]$$,$$G[i,b]$$的值或者等于0或者等于1。易知当且仅当$$G[a,i], G[i,b]$$都是1的时候值为1，即如果从点a到点i、点i到b都有边，那么值为1。 而G2 \[a,b\]的值就等于值为1的项数，也就是从点a到点b经过1个中间点的路径条 数。我们继续考虑$$G^3$$：

$$G^3 [a,b] =\sum\limits_{i=1}^N\sum\limits_{j=1}^N G[a,i]G[i,j]G[j,b]$$

和$$G2$$很相似，$$G[a,i]G[i,j]G[j,b] = 1$$ 当且仅当$$G[a,i] = G[i,j] = G[j,b] = 1$$，也就是a−i−j−b组成一条路经。那么$$G^3 [a,b]$$的值就是从点a到点b经过2个中间点的路径条数。从另一个方面来说，$$G3 =G^2G$$，从点a到点b经过2个中间点的路径中，第二个中间点是i的路径条数恰好为$$G^2 [a,i]G[i,b]$$，从这里也可 以说明上一个结论。更一般的，我们可以通过归纳法推导出$$G^k [a,b]$$等于就a到b经过k −1个中间点也就是长度为k的路径条数。

前面的证明当中并没有用到任何无向图的信息，因此这个结论也适用于有向图。 那么对于有重边的图，我们只需要把$$G[a,b]$$改为表示点a,b之间重边的条数即可。证明和前面的几乎一样，此处就不在赘述。

而对于有向图的自环， 不需要特殊考虑。对于无向图的自环，我们通常是把$$G[a,a]$$加上2，这样在计算$$G^k$$的时候这条边就被算成2条不同的边，如果只加上1，又会不满足矩阵里所有元素和等于边数两倍的性质。需要怎样应具体情况具体分析。

例题：[BZOJ 1898 沼泽鳄鱼](http://www.lydsy.com/JudgeOnline/problem.php?id=1898) [题解](/BZOJ/p1898.md)

#### 扩展-求恰好经过K条边的最短路径

例题: [Luogu 2886 \[USACO07NOV\]牛继电器Cow Relays](https://www.luogu.org/problem/show?pid=2886) [题解
](/Luogu/p2886.md)
