# 树上差分

就是前缀和

### 应用

1.找出被所有路径都覆盖的边

在树中将所有路径起、始权值加1，起、始点的lca权值减2，从所有叶节点开始把权值往上累加。

最终权值为路径数的点到其父亲的边为所求边。  
![](/assets/TSD.png)  
大概就是这样 →\_→

```cpp
void dfs(int u) {
    for(int i=head[s],y; i!=-1; t=E[i].nxt) {
        dfs(E[i].v);
        cnt[s]+=cnt[y];
    }
}
```

2、将每条路径（s，t\)上的每个点权值增加1，求各点权值  
在树中将所有路径起、始权值加1，起、始点的lca权值减1\(加了两次\)，lca的父亲权值减1（后缀和补丁），从所有叶节点开始把权值往上累加。还是后缀和。  
![](/assets/TSD-2.jpg)  
大概就是这样 →\_→

**例题**

[\[NOIP 2015\] 运输计划](http://www.lydsy.com/JudgeOnline/problem.php?id=4326) [题解](/BZOJ/p4326.md)

